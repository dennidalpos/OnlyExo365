<UserControl x:Class="ExchangeAdmin.Presentation.Views.MailFlowView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="Mail Flow Essentials" FontSize="20" FontWeight="SemiBold" DockPanel.Dock="Left"/>
            <Button Content="Refresh" Command="{Binding MailFlow.RefreshCommand}" Style="{StaticResource PrimaryButton}" DockPanel.Dock="Right"/>
        </DockPanel>

        <Border Grid.Row="1" Background="#3D0000" BorderBrush="{StaticResource ErrorBrush}"
                BorderThickness="1" CornerRadius="4" Padding="12" Margin="0,0,0,8"
                Visibility="{Binding MailFlow.HasError, Converter={StaticResource BoolToVisibility}}">
            <TextBlock Text="{Binding MailFlow.ErrorMessage}" TextWrapping="Wrap"/>
        </Border>

        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.2*"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="1.2*"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <GroupBox Header="Transport Rules" Grid.Row="0" Margin="0,0,0,8">
                    <DockPanel>
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="0,0,0,8">
                            <Button Content="Enable" Command="{Binding MailFlow.EnableRuleCommand}" Style="{StaticResource PrimaryButton}" Margin="0,0,8,0"/>
                            <Button Content="Disable" Command="{Binding MailFlow.DisableRuleCommand}" Style="{StaticResource PrimaryButton}" Margin="0,0,8,0"/>
                            <Button Content="Delete" Command="{Binding MailFlow.RemoveRuleCommand}" Style="{StaticResource PrimaryButton}"/>
                        </StackPanel>
                        <DataGrid ItemsSource="{Binding MailFlow.TransportRules}" SelectedItem="{Binding MailFlow.SelectedRule, Mode=TwoWay}" AutoGenerateColumns="False" IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="90"/>
                                <DataGridTextColumn Header="State" Binding="{Binding State}" Width="120"/>
                                <DataGridTextColumn Header="Mode" Binding="{Binding Mode}" Width="120"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </GroupBox>

                <GroupBox Header="Connectors" Grid.Row="1" Margin="0,0,0,8">
                    <DockPanel>
                        <Button Content="Delete Selected" DockPanel.Dock="Top" Margin="0,0,0,8" Command="{Binding MailFlow.RemoveConnectorCommand}" Style="{StaticResource PrimaryButton}"/>
                        <DataGrid ItemsSource="{Binding MailFlow.Connectors}" SelectedItem="{Binding MailFlow.SelectedConnector, Mode=TwoWay}" AutoGenerateColumns="False" IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="120"/>
                                <DataGridCheckBoxColumn Header="Enabled" Binding="{Binding Enabled}" Width="90"/>
                                <DataGridTextColumn Header="Comment" Binding="{Binding Comment}" Width="1.4*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </GroupBox>

                <GroupBox Header="Accepted Domains" Grid.Row="2">
                    <DockPanel>
                        <Button Content="Delete Selected" DockPanel.Dock="Top" Margin="0,0,0,8" Command="{Binding MailFlow.RemoveDomainCommand}" Style="{StaticResource PrimaryButton}"/>
                        <DataGrid ItemsSource="{Binding MailFlow.AcceptedDomains}" SelectedItem="{Binding MailFlow.SelectedDomain, Mode=TwoWay}" AutoGenerateColumns="False" IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Domain" Binding="{Binding DomainName}" Width="*"/>
                                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="1.1*"/>
                                <DataGridTextColumn Header="Type" Binding="{Binding DomainType}" Width="140"/>
                                <DataGridCheckBoxColumn Header="Default" Binding="{Binding Default}" Width="90"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </DockPanel>
                </GroupBox>
            </Grid>

            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <GroupBox Header="Create / Edit Transport Rule" Margin="0,0,0,8">
                        <StackPanel Margin="8">
                            <TextBlock Text="Identity (edit only)"/>
                            <TextBox Text="{Binding MailFlow.RuleIdentity}" IsReadOnly="True"/>
                            <TextBlock Text="Name" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.RuleName, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="From (csv)" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.RuleFrom}"/>
                            <TextBlock Text="SentTo (csv)" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.RuleSentTo}"/>
                            <TextBlock Text="SubjectContainsWords (csv)" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.RuleSubjectContains}"/>
                            <TextBlock Text="PrependSubject" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.RulePrependSubject}"/>
                            <TextBlock Text="Mode" Margin="0,6,0,0"/>
                            <ComboBox ItemsSource="{Binding MailFlow.RuleModes}" SelectedItem="{Binding MailFlow.RuleMode}"/>
                            <CheckBox Content="Enabled" IsChecked="{Binding MailFlow.RuleEnabled}" Margin="0,6,0,0"/>
                            <TextBlock Text="{Binding MailFlow.RuleValidationMessage}" Foreground="Orange" TextWrapping="Wrap" Margin="0,6,0,0"
                                       Visibility="{Binding MailFlow.IsRuleInputValid, Converter={StaticResource InverseBoolToVisibility}}"/>
                            <Button Content="Save Rule" Command="{Binding MailFlow.SaveRuleCommand}" Style="{StaticResource PrimaryButton}" Margin="0,8,0,0"
                                    IsEnabled="{Binding MailFlow.IsRuleInputValid}"/>
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Test Transport Rules" Margin="0,0,0,8">
                        <StackPanel Margin="8">
                            <TextBlock Text="Sender"/>
                            <TextBox Text="{Binding MailFlow.TestSender, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="Recipient" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.TestRecipient, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="Subject" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.TestSubject}"/>
                            <TextBlock Text="{Binding MailFlow.TestValidationMessage}" Foreground="Orange" TextWrapping="Wrap" Margin="0,6,0,0"
                                       Visibility="{Binding MailFlow.IsRuleTestInputValid, Converter={StaticResource InverseBoolToVisibility}}"/>
                            <Button Content="Test" Command="{Binding MailFlow.TestRuleCommand}" Style="{StaticResource PrimaryButton}" Margin="0,8,0,0"
                                    IsEnabled="{Binding MailFlow.IsRuleTestInputValid}"/>
                            <TextBlock Text="Result" Margin="0,8,0,0" FontWeight="SemiBold"/>
                            <TextBlock Text="{Binding MailFlow.TestResult}" TextWrapping="Wrap"/>
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Create / Edit Connector" Margin="0,0,0,8">
                        <StackPanel Margin="8">
                            <TextBlock Text="Identity (edit only)"/>
                            <TextBox Text="{Binding MailFlow.ConnectorIdentity}" IsReadOnly="True"/>
                            <TextBlock Text="Type" Margin="0,6,0,0"/>
                            <ComboBox ItemsSource="{Binding MailFlow.ConnectorTypes}" SelectedItem="{Binding MailFlow.ConnectorType}"/>
                            <TextBlock Text="Name" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.ConnectorName, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="Comment" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.ConnectorComment}"/>
                            <TextBlock Text="SenderDomains (csv)" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.ConnectorSenderDomains, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="RecipientDomains (csv)" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.ConnectorRecipientDomains, UpdateSourceTrigger=PropertyChanged}"/>
                            <CheckBox Content="Enabled" IsChecked="{Binding MailFlow.ConnectorEnabled}" Margin="0,6,0,0"/>
                            <TextBlock Text="{Binding MailFlow.ConnectorValidationMessage}" Foreground="Orange" TextWrapping="Wrap" Margin="0,6,0,0"
                                       Visibility="{Binding MailFlow.IsConnectorInputValid, Converter={StaticResource InverseBoolToVisibility}}"/>
                            <Button Content="Save Connector" Command="{Binding MailFlow.SaveConnectorCommand}" Style="{StaticResource PrimaryButton}" Margin="0,8,0,0"
                                    IsEnabled="{Binding MailFlow.IsConnectorInputValid}"/>
                        </StackPanel>
                    </GroupBox>

                    <GroupBox Header="Create / Edit Accepted Domain">
                        <StackPanel Margin="8">
                            <TextBlock Text="Identity (edit only)"/>
                            <TextBox Text="{Binding MailFlow.DomainIdentity}" IsReadOnly="True"/>
                            <TextBlock Text="Name" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.DomainName, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="Domain FQDN" Margin="0,6,0,0"/>
                            <TextBox Text="{Binding MailFlow.DomainFqdn, UpdateSourceTrigger=PropertyChanged}"/>
                            <TextBlock Text="Domain Type" Margin="0,6,0,0"/>
                            <ComboBox ItemsSource="{Binding MailFlow.DomainTypes}" SelectedItem="{Binding MailFlow.DomainType}"/>
                            <CheckBox Content="Make Default" IsChecked="{Binding MailFlow.DomainMakeDefault}" Margin="0,6,0,0"/>
                            <TextBlock Text="{Binding MailFlow.DomainValidationMessage}" Foreground="Orange" TextWrapping="Wrap" Margin="0,6,0,0"
                                       Visibility="{Binding MailFlow.IsDomainInputValid, Converter={StaticResource InverseBoolToVisibility}}"/>
                            <Button Content="Save Domain" Command="{Binding MailFlow.SaveDomainCommand}" Style="{StaticResource PrimaryButton}" Margin="0,8,0,0"
                                    IsEnabled="{Binding MailFlow.IsDomainInputValid}"/>
                        </StackPanel>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>
        </Grid>
    </Grid>
</UserControl>
